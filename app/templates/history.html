{% extends "base.html" %}
{% block title %}Storico â€” Crocette{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Storico</h1>

<form method="get" action="/storico" class="flex flex-wrap gap-3 items-end mb-4">
  <div>
    <label class="block text-sm opacity-80 mb-1">Tipo</label>
    <select name="kind" class="px-3 py-2 rounded bg-neutral-900">
      <option value="" {{ '' == kind and 'selected' or '' }}>Tutti</option>
      <option value="debit" {{ 'debit' == kind and 'selected' or '' }}>Debiti</option>
      <option value="credit" {{ 'credit' == kind and 'selected' or '' }}>Crediti</option>
    </select>
  </div>
  <div>
    <label class="block text-sm opacity-80 mb-1">Giocatore</label>
    <select name="member_id" class="px-3 py-2 rounded bg-neutral-900">
      <option value="">Tutti</option>
      {% for m in members %}
      <option value="{{ m.id }}" {{ member_id == m.id and 'selected' or '' }}>{{ m.name }}</option>
      {% endfor %}
    </select>
  </div>
  <button class="px-4 py-2 rounded-lg border border-neutral-700 hover:border-team">Filtra</button>
</form>

<div class="mb-3 text-sm opacity-80">
  Totale crocette in elenco: <b>{{ total }}</b>
</div>

<ul class="space-y-2">
  {% for m in moves %}
  <li class="p-2 rounded bg-neutral-900 flex justify-between items-center">
    <span>
      <b>{{ m.member.name }}</b> â€” {{ 'debito' if m.kind == 'debit' else 'credito' }}
      {% if m.crocette %}{{ m.crocette }} âŒ{% endif %}
      {% if m.rule %}<span class="opacity-70">({{ m.rule.title }})</span>{% endif %}
      {% if m.note %} â€” {{ m.note }}{% endif %}
    </span>

    <span class="flex items-center gap-2">
      <span class="opacity-70 text-sm">{{ m.created_at.strftime('%d/%m/%Y %H:%M') }}</span>

      {% if user and user.role == 'admin' %}
      <form method="post" action="/movements/delete"
            onsubmit="return confirm('Eliminare definitivamente questo movimento?');">
        <input type="hidden" name="movement_id" value="{{ m.id }}">
        <input type="hidden" name="next"
               value="/storico?kind={{ kind }}{% if member_id %}&member_id={{ member_id }}{% endif %}">
        <button class="px-2 py-1 rounded border border-neutral-700 text-xs hover:border-team" title="Elimina">
          ğŸ—‘ï¸ Elimina
        </button>
      </form>
      {% endif %}
    </span>
  </li>
  {% else %}
  <li class="opacity-70">Nessun movimento trovato.</li>
  {% endfor %}
</ul>
{% endblock %}
